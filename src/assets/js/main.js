---
# Front matter to make Jekyll to post-process it via Liquid
---

// Service workers are not supported by all browsers
if ("serviceWorker" in navigator) {

  window.addEventListener("load", () => {
    navigator.serviceWorker
      // A little liquid is in the next line. It helps us understand the scope 
      // of the service worker. Note that this file does not exist by default
      // and is generated by the Continuous Integration pipeline.
      .register("{{ '/service-worker.js' | relative_url }}")


      .then((registration) => { 
        console.debug('Service Worker registered:', registration);

          // Listen for updates
          registration.addEventListener('updatefound', () => {
            console.debug('New Service Worker found...');
            const newWorker = registration.installing;
            
            if (newWorker) {
                newWorker.addEventListener('statechange', () => {
                    if (newWorker.state === 'installed' && navigator.serviceWorker.controller) {
                        console.debug('New version available. Reloading...');
                        window.location.reload();
                    }
                });
            }
        });
      })

      .catch(() => { console.error("Service worker registration failed") });
  });
}
